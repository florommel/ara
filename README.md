ARA - Automatic Real-time System Analyzer
=========================================

Tool to automatically analyse real-time systems.
Currently capable of systems written with FreeRTOS and OSEK.

Building
--------

The following dependencies are needed:

- [meson](https://mesonbuild.com/) (>=0.48.0)
- [llvm](http://llvm.org/) (==7.0)
- [cython](https://cython.org/) (>=0.26.1)
- [python](https://www.python.org/) (>=3.6)

Getting packages in SRA lab:
```
echo addpackage llvm-7.0 >> ~/.bashrc
echo export LD_LIBRARY_PATH=/proj/opt/llvm-7.0/lib:\$LD_LIBRARY_PATH >> ~/.bashrc
echo export PATH=`pwd`/.local/bin:\$PATH >> ~/.bashrc
. ~/.bashrc
pip3 install --user meson
```


To build the program type:
```
meson build
cd build
ninja
```
(Note: `build` is actually a placeholder for an arbitrary path.)

Usage
-----

To run the program `ara.py` needs to be executed with the correct `PYTHONPATH`.
For convenience a small wrapper script is generated by meson that sets the correct environment variables. Run this with:
```
build/ara.sh -h
```

Note: The input of the program are some LLVM IR files. To compile a C/C++ application into IR files, invoke clang with the flags described in `appl/meson.build`.

Test Cases
----------

There are some predefined test cases. Run them with:
```
cd build
meson test
```

Architecture
------------

ARA is devided into steps that operate on the same system model. When starting the program the correct chain of steps is calculated and then executed. A listing of the steps can be retrieved by:
```
build/ara.sh -l
```
Steps can be written into Python (defined in `steps`) or in C++ (defined in `steps/native`).
The model is written in C++ with Python bindings (defined in `libgraph`).

Developing
----------
If you want to develop with ARA, some common actions are usual.

### Adding a new Python step

- Create the step in the `steps` directory. You can use `steps/dummy.py` as template.
- Add the step to `steps/__init__.py`.
  - Add to the `__all__`-attribute.
  - Add to the `provide_steps()` function.
- Create a test case for this step in the `test` directory. See the existing tests and `test/meson.build` for hints how to achieve this.

### Adding a new C++ step

- Create the step in the `steps/native` directory. You can use `steps/native/cdummy.{cpp,h,pxd}` as template.
- Add the step to `steps/native/meson.build` (both the `pxd` and the `cpp` file) to enable compilation.
- Add the step to `steps/native/native_step.pyx` to create a Python wrapper. Add an `cimport` and add the step to `provide_steps`.
- Create a test case for this step in the `test/native_step_test` directory. Usually, it is enough to add your test to `test/native_step_test/meson.build`.
  - C++ steps often need other C++ code to test it. For that add an extra test step in `steps/native/test.h` and `steps/native/test/` and call it from your test case.

Troubleshooting
---------------

### LLVM is not found
Sometime Meson is unable to find the correct LLVM libraries because detection of the `llvm-config` file fails.
In this case, add a file `native.txt` with this content:
```
[binaries]
llvm-config = '/path/to/llvm-config'
```
Then configure your build directory with:
```
meson build --native-file native.txt
```
